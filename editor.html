<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ - –ö–æ–º-–ö–æ–º</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1e293b;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 28px;
            margin: 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .app-version {
            font-size: 14px;
            opacity: 0.9;
            background: rgba(255,255,255,0.15);
            padding: 4px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .header-right {
            display: flex;
            gap: 16px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .main-content {
            display: flex;
            min-height: 800px;
            height: calc(100vh - 200px);
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .left-panel {
            width: 350px;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .card-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .card-search {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            position: relative;
        }

        .card-search input {
            width: 100%;
            padding: 12px 16px;
            padding-left: 44px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            background: white;
            transition: all 0.3s;
        }

        .card-search input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .card-search::before {
            content: "üîç";
            position: absolute;
            left: 32px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            opacity: 0.5;
        }

        .filters {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #334155;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-group select:hover {
            border-color: #cbd5e1;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .card-list {
            list-style: none;
        }

        .card-list-item {
            padding: 16px;
            border: 2px solid #e2e8f0;
            margin-bottom: 12px;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .card-list-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card-list-item:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
            transform: translateX(4px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .card-list-item:hover::before {
            opacity: 1;
        }

        .card-list-item.selected {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .card-list-item.selected::before {
            opacity: 1;
        }

        .card-list-item .card-emoji {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 10px;
            color: white;
            flex-shrink: 0;
        }

        .card-list-item .card-text {
            flex: 1;
            font-size: 15px;
            font-weight: 500;
            color: #1e293b;
        }

        .card-list-item .card-id {
            font-size: 11px;
            color: #64748b;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .card-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            border-radius: 6px;
            border: 2px solid #cbd5e1;
            appearance: none;
            position: relative;
            flex-shrink: 0;
        }

        .card-checkbox:checked {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .card-checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .right-panel {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 16px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.2);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #64748b, #475569);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3);
        }

        .btn-info {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #0891b2, #0e7490);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
        }

        .status-bar {
            display: flex;
            gap: 16px;
            align-items: center;
            font-size: 14px;
            color: #64748b;
            flex-wrap: wrap;
            background: #f8fafc;
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        #saveStatus {
            padding: 8px 16px;
            border-radius: 8px;
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            font-size: 13px;
            font-weight: 600;
            display: none;
            animation: slideIn 0.3s ease;
        }

        #saveStatus.saving {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
        }

        #saveStatus.error {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
        .preview-btn-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mini-preview {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            border: 3px solid;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .mini-preview::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .mini-preview:hover::after {
            transform: translateX(100%);
        }

        .mini-preview:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        /* –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .editor-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            flex: 1;
        }

        .form-section {
            background: #f8fafc;
            padding: 24px;
            border-radius: 16px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .form-section:hover {
            border-color: #cbd5e1;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
        }

        .form-section h3 {
            margin-bottom: 20px;
            color: #1e293b;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section h3::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #334155;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s;
        }

        .checkbox-item:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid #cbd5e1;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"]:checked {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
        .preview-modal .modal-content {
            max-width: 900px;
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-preview-container {
            display: flex;
            gap: 40px;
            align-items: center;
            flex-wrap: wrap;
        }

        .preview-card {
            width: 280px;
            min-width: 280px;
            height: 350px;
            border: 4px solid;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .preview-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            z-index: 1;
        }

        .preview-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
        }

        .preview-emoji {
            font-size: 80px;
            margin-bottom: 20px;
            z-index: 2;
            animation: float 3s ease-in-out infinite;
        }

        .preview-text {
            font-size: 28px;
            text-align: center;
            padding: 0 20px;
            word-break: break-word;
            font-weight: 700;
            z-index: 2;
            color: #1e293b;
        }

        .preview-id {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 14px;
            color: rgba(30, 41, 59, 0.7);
            background: rgba(255,255,255,0.9);
            padding: 6px 12px;
            border-radius: 8px;
            z-index: 2;
            font-weight: 500;
        }

        .preview-info {
            flex: 1;
            min-width: 320px;
            font-size: 15px;
            line-height: 1.7;
        }

        .preview-info h4 {
            margin-bottom: 20px;
            color: #1e293b;
            font-size: 20px;
            font-weight: 700;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        .preview-info-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-info-label {
            font-weight: 600;
            color: #475569;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .preview-info-value {
            color: #1e293b;
            font-weight: 500;
            text-align: right;
            max-width: 200px;
            word-break: break-word;
            background: #f8fafc;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
        }

        /* –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä */
        .metadata-editor {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
        }

        .metadata-section {
            margin-bottom: 24px;
        }

        .metadata-section h4 {
            margin-bottom: 12px;
            color: #1e293b;
            font-size: 15px;
            font-weight: 600;
        }

        .metadata-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .metadata-btn {
            padding: 10px 16px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .metadata-btn:hover {
            background: #f0f9ff;
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .metadata-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        .allowed-objects-editor {
            margin-top: 20px;
        }

        .search-container {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .search-container input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .search-container input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .objects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            max-height: 240px;
            overflow-y: auto;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .object-item {
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 14px;
        }

        .object-item:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15);
        }

        .object-item.selected {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            font-weight: 600;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15);
        }

        .object-item .emoji {
            font-size: 28px;
            display: block;
            margin-bottom: 10px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –§–æ—Ä–º—ã —Å–ª–æ–≤ */
        .word-forms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
        }

        .word-form-item {
            margin-bottom: 12px;
        }

        .word-form-item label {
            display: block;
            font-size: 13px;
            color: #64748b;
            margin-bottom: 6px;
            font-weight: 500;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 40px 80px rgba(0,0,0,0.25);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-header {
            padding: 24px;
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            color: #1e293b;
            font-size: 20px;
            font-weight: 700;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-radius: 0 0 20px 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        /* –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ */
        .sort-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .sort-btn {
            padding: 10px 16px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .sort-btn:hover {
            background: #f0f9ff;
            border-color: #3b82f6;
        }

        .sort-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        /* –í–∞–ª–∏–¥–∞—Ü–∏—è */
        .validation-results {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            border: 2px solid #fbbf24;
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            animation: slideIn 0.4s ease;
        }

        .validation-results h4 {
            color: #92400e;
            margin-bottom: 16px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .validation-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            border-left: 4px solid;
            animation: fadeInUp 0.4s ease;
        }

        .validation-item.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .validation-item.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .validation-item.success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }

        /* –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ */
        .bulk-edit {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 2px solid #86efac;
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            animation: slideIn 0.4s ease;
        }

        .bulk-edit h4 {
            color: #166534;
            margin-bottom: 16px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä */
        .json-editor {
            font-family: 'JetBrains Mono', 'Cascadia Code', monospace;
            font-size: 13px;
            line-height: 1.5;
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            max-height: 320px;
            overflow-y: auto;
            border: 2px solid #1e293b;
        }

        .json-key { color: #7dd3fc; }
        .json-string { color: #86efac; }
        .json-number { color: #fca5a5; }
        .json-boolean { color: #c084fc; }
        .json-null { color: #94a3b8; }

        /* –î—É–±–ª–∏–∫–∞—Ç—ã */
        .duplicate-item {
            padding: 20px;
            margin-bottom: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            background: white;
            animation: fadeInUp 0.4s ease;
        }

        .duplicate-item h5 {
            margin-bottom: 12px;
            color: #1e293b;
            font-size: 16px;
        }

        .duplicate-cards {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
        }

        .duplicate-card {
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e2e8f0;
            transition: all 0.3s;
        }

        .duplicate-card:hover {
            background: #f0f9ff;
            border-color: #3b82f6;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
        .autosave-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: #475569;
        }

        .autosave-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .autosave-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1200px) {
            .editor-form {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }
            
            .left-panel {
                width: 100%;
                max-height: 500px;
            }
            
            .card-preview-container {
                flex-direction: column;
                align-items: center;
            }
            
            .preview-card {
                align-self: center;
            }
        }

        @media (max-width: 768px) {
            .editor-form {
                grid-template-columns: 1fr;
            }
            
            .toolbar {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }
            
            .button-group {
                justify-content: center;
            }
            
            header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
                text-align: center;
            }
            
            .header-right {
                justify-content: center;
            }
            
            .preview-info {
                min-width: 100%;
            }
            
            .status-bar {
                justify-content: center;
                text-align: center;
            }
        }

        /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ */
        .form-group small {
            display: block;
            margin-top: 6px;
            font-size: 12px;
            color: #64748b;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            from {
                left: -100%;
            }
            to {
                left: 100%;
            }
        }

        /* –§—É—Ç–µ—Ä —Å –ª–∏—Ü–µ–Ω–∑–∏–µ–π */
        .footer {
            padding: 20px 32px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            text-align: center;
            color: #64748b;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #3b82f6;
            text-decoration: none;
            transition: all 0.3s;
        }

        .footer-link:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }

        .copyright {
            font-size: 13px;
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <div>
                    <h1>üé¥ –†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ –ö–æ–º-–ö–æ–º</h1>
                    <div class="app-version">–í–µ—Ä—Å–∏—è 2.2 ‚Ä¢ –£–º–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä AAC</div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="status-bar">
                    <span id="cardCount">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫...</span>
                    <span id="selectedCount">0 –≤—ã–±—Ä–∞–Ω–æ</span>
                    <span id="saveStatus"></span>
                    <div class="autosave-controls" id="autosaveControls">
                        <div class="autosave-toggle">
                            <input type="checkbox" id="autosaveToggle" checked>
                            <label for="autosaveToggle">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</label>
                        </div>
                        <span id="lastSaveTime">–ù–∏–∫–æ–≥–¥–∞</span>
                    </div>
                </div>
                <a href="https://zlovreda.github.io/Kom-Kom-Communicator/" target="_blank" class="btn btn-success">üöÄ –ü–µ—Ä–µ–π—Ç–∏ –≤ –ö–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä</a>
            </div>
        </header>

        <div class="main-content">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="left-panel">
                <div class="card-search">
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, ID –∏–ª–∏ —Ç–µ–≥–∞–º...">
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>üìÅ –¢–∏–ø –∫–∞—Ä—Ç–æ—á–∫–∏:</label>
                        <select id="typeFilter">
                            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                            <option value="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                            <option value="action">–î–µ–π—Å—Ç–≤–∏–µ</option>
                            <option value="object">–û–±—ä–µ–∫—Ç</option>
                            <option value="person">–ß–µ–ª–æ–≤–µ–∫</option>
                            <option value="place">–ú–µ—Å—Ç–æ</option>
                            <option value="emotion">–≠–º–æ—Ü–∏—è</option>
                            <option value="pain">–ë–æ–ª—å</option>
                            <option value="time">–í—Ä–µ–º—è</option>
                            <option value="dialog">–î–∏–∞–ª–æ–≥</option>
                            <option value="learning">–û–±—É—á–µ–Ω–∏–µ</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>üîÄ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                        <select id="sortSelect">
                            <option value="text">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                            <option value="text-desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                            <option value="id">–ü–æ ID</option>
                            <option value="type">–ü–æ —Ç–∏–ø—É</option>
                            <option value="usageCount">–ü–æ —á–∞—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</option>
                            <option value="created">–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è</option>
                        </select>
                    </div>
                </div>
                
                <div class="card-list-container">
                    <div class="sort-controls">
                        <button class="sort-btn" data-sort="text">üìù –ê-–Ø</button>
                        <button class="sort-btn" data-sort="type">üìÅ –¢–∏–ø</button>
                        <button class="sort-btn" data-sort="usageCount">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</button>
                    </div>
                    
                    <ul class="card-list" id="cardList">
                        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </ul>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="right-panel">
                <div class="toolbar">
                    <div class="button-group">
                        <button class="btn btn-primary" id="addCardBtn">‚ú® + –ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞</button>
                        <button class="btn btn-success" id="saveCardBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn btn-warning" id="duplicateBtn">‚éò –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger" id="deleteCardBtn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    
                    <div class="button-group">
                        <div class="preview-btn-container">
                            <div class="mini-preview" id="miniPreview" title="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ (–Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è)">
                                <div id="miniPreviewEmoji">üéÆ</div>
                            </div>
                            <button class="btn btn-info" id="previewBtn">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                        </div>
                        <button class="btn btn-info" id="findDuplicatesBtn">üîç –ù–∞–π—Ç–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã</button>
                        <button class="btn btn-secondary" id="importBtn">üì• –ò–º–ø–æ—Ä—Ç</button>
                        <button class="btn btn-secondary" id="exportBtn">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                        <button class="btn btn-secondary" id="loadFromServerBtn">üåê –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞</button>
                        <button class="btn btn-secondary" id="validateBtn">‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div class="editor-form" id="editorForm">
                    <div class="form-section">
                        <h3>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        
                        <div class="form-group">
                            <label for="cardId">üîñ ID –∫–∞—Ä—Ç–æ—á–∫–∏:</label>
                            <input type="text" id="cardId" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: CAT-GAMES" required>
                            <small>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –§–æ—Ä–º–∞—Ç: –¢–ò–ü-–ù–ê–ó–í–ê–ù–ò–ï (–∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardText">üìù –¢–µ–∫—Å—Ç (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞):</label>
                            <input type="text" id="cardText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∏–≥—Ä–∞—Ç—å" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardEmoji">üé® –≠–º–æ–¥–∑–∏:</label>
                            <input type="text" id="cardEmoji" placeholder="üéÆ" maxlength="3">
                            <small>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 1-3 —Å–∏–º–≤–æ–ª–∞ —ç–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardType">üìÅ –¢–∏–ø –∫–∞—Ä—Ç–æ—á–∫–∏:</label>
                            <select id="cardType">
                                <option value="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                                <option value="action">–î–µ–π—Å—Ç–≤–∏–µ</option>
                                <option value="object">–û–±—ä–µ–∫—Ç</option>
                                <option value="person">–ß–µ–ª–æ–≤–µ–∫</option>
                                <option value="place">–ú–µ—Å—Ç–æ</option>
                                <option value="emotion">–≠–º–æ—Ü–∏—è</option>
                                <option value="pain">–ë–æ–ª—å</option>
                                <option value="time">–í—Ä–µ–º—è</option>
                                <option value="dialog">–î–∏–∞–ª–æ–≥</option>
                                <option value="learning">–û–±—É—á–µ–Ω–∏–µ</option>
                                <option value="color">–¶–≤–µ—Ç</option>
                                <option value="help">–ü–æ–º–æ—â—å</option>
                                <option value="request">–ó–∞–ø—Ä–æ—Å</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardCategory">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                            <select id="cardCategory">
                                <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üé® –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
                        
                        <div class="form-group">
                            <label for="cardColor">üé® –¶–≤–µ—Ç —Ñ–æ–Ω–∞:</label>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <input type="color" id="cardColor" value="#E3F2FD" style="width: 60px; height: 40px; border-radius: 8px;">
                                <span id="colorValue" style="font-size: 14px; color: #64748b;">#E3F2FD</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="borderColor">üñºÔ∏è –¶–≤–µ—Ç —Ä–∞–º–∫–∏:</label>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <input type="color" id="borderColor" value="#2196F3" style="width: 60px; height: 40px; border-radius: 8px;">
                                <span id="borderColorValue" style="font-size: 14px; color: #64748b;">#2196F3</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>üì± –°–µ–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                            <div class="checkbox-group" id="sectionsCheckbox">
                                <!-- –°–µ–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üìö –ì—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—ã</h3>
                        
                        <div class="word-forms-grid">
                            <div class="word-form-item">
                                <label for="formAccusative">–í–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π (–∫–æ–≥–æ? —á—Ç–æ?)</label>
                                <input type="text" id="formAccusative" placeholder="—è–±–ª–æ–∫–æ">
                            </div>
                            
                            <div class="word-form-item">
                                <label for="formGenitive">–†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π (–∫–æ–≥–æ? —á–µ–≥–æ?)</label>
                                <input type="text" id="formGenitive" placeholder="—è–±–ª–æ–∫–∞">
                            </div>
                            
                            <div class="word-form-item">
                                <label for="formDative">–î–∞—Ç–µ–ª—å–Ω—ã–π (–∫–æ–º—É? —á–µ–º—É?)</label>
                                <input type="text" id="formDative" placeholder="—è–±–ª–æ–∫—É">
                            </div>
                            
                            <div class="word-form-item">
                                <label for="formInstrumental">–¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π (–∫–µ–º? —á–µ–º?)</label>
                                <input type="text" id="formInstrumental" placeholder="—è–±–ª–æ–∫–æ–º">
                            </div>
                            
                            <div class="word-form-item">
                                <label for="formPrepositional">–ü—Ä–µ–¥–ª–æ–∂–Ω—ã–π (–æ –∫–æ–º? –æ —á–µ–º?)</label>
                                <input type="text" id="formPrepositional" placeholder="—è–±–ª–æ–∫–µ">
                            </div>
                            
                            <div class="word-form-item">
                                <label for="formWith">–° –ø—Ä–µ–¥–ª–æ–≥–æ–º "—Å"</label>
                                <input type="text" id="formWith" placeholder="—Å —è–±–ª–æ–∫–æ–º">
                            </div>
                            
                            <div class="word-form-item">
                                <label for="formIn">–° –ø—Ä–µ–¥–ª–æ–≥–æ–º "–≤"</label>
                                <input type="text" id="formIn" placeholder="–≤ —è–±–ª–æ–∫–æ">
                            </div>
                            
                            <div class="word-form-item">
                                <label for="formOn">–° –ø—Ä–µ–¥–ª–æ–≥–æ–º "–Ω–∞"</label>
                                <input type="text" id="formOn" placeholder="–Ω–∞ —è–±–ª–æ–∫–µ">
                            </div>
                        </div>
                    </div>

                    <div class="form-section" style="grid-column: 1 / -1;">
                        <h3>‚öôÔ∏è –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</h3>
                        
                        <div class="metadata-editor">
                            <div class="metadata-section">
                                <h4>üîó –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:</h4>
                                <div class="metadata-controls">
                                    <button class="metadata-btn" data-field="allowedWith" data-value="people">üë• –õ—é–¥–∏</button>
                                    <button class="metadata-btn" data-field="allowedWith" data-value="pets">üêæ –ü–∏—Ç–æ–º—Ü—ã</button>
                                    <button class="metadata-btn" data-field="allowedWith" data-value="places">üè† –ú–µ—Å—Ç–∞</button>
                                    <button class="metadata-btn" data-field="allowedWith" data-value="objects">üì¶ –û–±—ä–µ–∫—Ç—ã</button>
                                    <button class="metadata-btn" data-field="allowedWith" data-value="time">‚è∞ –í—Ä–µ–º—è</button>
                                </div>
                            </div>
                            
                            <div class="metadata-section">
                                <h4>üìä –õ–∏–º–∏—Ç—ã:</h4>
                                <div class="metadata-controls">
                                    <div class="form-group" style="margin: 0;">
                                        <label for="maxPeople" style="font-size: 12px;">üë• –ú–∞–∫—Å. –ª—é–¥–µ–π:</label>
                                        <input type="number" id="maxPeople" min="0" value="0" style="width: 80px; padding: 8px;">
                                    </div>
                                    <div class="form-group" style="margin: 0;">
                                        <label for="maxPets" style="font-size: 12px;">üêæ –ú–∞–∫—Å. –ø–∏—Ç–æ–º—Ü–µ–≤:</label>
                                        <input type="number" id="maxPets" min="0" value="0" style="width: 80px; padding: 8px;">
                                    </div>
                                    <div class="form-group" style="margin: 0;">
                                        <label for="maxPlaces" style="font-size: 12px;">üè† –ú–∞–∫—Å. –º–µ—Å—Ç:</label>
                                        <input type="number" id="maxPlaces" min="0" value="0" style="width: 80px; padding: 8px;">
                                    </div>
                                    <div class="form-group" style="margin: 0;">
                                        <label for="maxObjects" style="font-size: 12px;">üì¶ –ú–∞–∫—Å. –æ–±—ä–µ–∫—Ç–æ–≤:</label>
                                        <input type="number" id="maxObjects" min="0" value="0" style="width: 80px; padding: 8px;">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metadata-section">
                                <h4>üéØ –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:</h4>
                                <div class="allowed-objects-editor">
                                    <div class="search-container">
                                        <input type="text" id="objectSearch" placeholder="–ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Ç–µ–≥–∞–º...">
                                        <button class="btn btn-secondary" id="clearObjectsBtn" style="padding: 10px 16px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
                                    </div>
                                    
                                    <div class="objects-grid" id="objectsGrid">
                                        <!-- –û–±—ä–µ–∫—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </div>
                                    
                                    <div id="selectedObjects" style="margin-top: 16px; font-size: 13px; color: #64748b; padding: 12px; background: #f8fafc; border-radius: 10px;">
                                        üéØ –í—ã–±—Ä–∞–Ω–æ: <span id="selectedObjectsCount" style="font-weight: 600; color: #3b82f6;">0</span> –æ–±—ä–µ–∫—Ç–æ–≤
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metadata-section">
                                <h4>üìù JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä:</h4>
                                <div class="json-editor" id="jsonEditor" contenteditable="true">
                                    {
  "allowedWith": [],
  "allowedObjects": [],
  "maxPeople": 0,
  "maxPets": 0,
  "maxPlaces": 0,
  "maxObjects": 0
}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üè∑Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                        
                        <div class="form-group">
                            <label for="cardTags">üè∑Ô∏è –¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
                            <input type="text" id="cardTags" placeholder="–∏–≥—Ä–∞, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –≤–µ—Å–µ–ª—å–µ">
                            <small>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="difficulty">üìà –°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                            <select id="difficulty">
                                <option value="1">üåü –û—á–µ–Ω—å –ª–µ–≥–∫–æ</option>
                                <option value="2">‚≠ê‚≠ê –õ–µ–≥–∫–æ</option>
                                <option value="3">‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω–µ</option>
                                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê –°–ª–æ–∂–Ω–æ</option>
                                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="status">üìä –°—Ç–∞—Ç—É—Å:</label>
                            <select id="status">
                                <option value="active">‚úÖ –ê–∫—Ç–∏–≤–Ω–∞</option>
                                <option value="disabled">‚≠ï –û—Ç–∫–ª—é—á–µ–Ω–∞</option>
                                <option value="hidden">üëÅÔ∏è‚Äçüó®Ô∏è –°–∫—Ä—ã—Ç–∞</option>
                                <option value="draft">üìù –ß–µ—Ä–Ω–æ–≤–∏–∫</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="usageCount">üî• –°—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</label>
                            <input type="number" id="usageCount" min="0" value="0">
                            <small>–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∫–∞—Ä—Ç–æ—á–∫–∞ –±—ã–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ</small>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        
                        <div class="form-group">
                            <label>üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</label>
                            <input type="text" id="createdDate" disabled style="background: #f8fafc; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0; color: #64748b;">
                        </div>
                        
                        <div class="form-group">
                            <label>üîÑ –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:</label>
                            <input type="text" id="modifiedDate" disabled style="background: #f8fafc; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0; color: #64748b;">
                        </div>
                        
                        <div class="form-group">
                            <label for="author">üë§ –ê–≤—Ç–æ—Ä:</label>
                            <select id="author">
                                <option value="system">ü§ñ –°–∏—Å—Ç–µ–º–∞</option>
                                <option value="user">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                                <option value="admin">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="version">üîÑ –í–µ—Ä—Å–∏—è:</label>
                            <input type="number" id="version" min="1" value="1" style="width: 100px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="description">üìù –û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                <div class="bulk-edit" id="bulkEditSection" style="display: none;">
                    <h4>üë• –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (<span id="bulkCount">0</span> –∫–∞—Ä—Ç–æ—á–µ–∫)</h4>
                    <div class="metadata-controls">
                        <button class="btn btn-secondary" id="bulkAddTagBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥</button>
                        <button class="btn btn-secondary" id="bulkRemoveTagBtn">‚ûñ –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥</button>
                        <button class="btn btn-secondary" id="bulkChangeStatusBtn">üìä –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                        <button class="btn btn-secondary" id="bulkChangeCategoryBtn">üè∑Ô∏è –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                        <button class="btn btn-secondary" id="resetSelectionBtn">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</button>
                        <button class="btn btn-warning" id="applyBulkBtn">üíæ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    </div>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
                <div class="validation-results" id="validationResults" style="display: none;">
                    <h4>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h4>
                    <div id="validationList">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>

        <!-- –§—É—Ç–µ—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏—Ü–µ–Ω–∑–∏–∏ -->
        <footer class="footer">
            <div class="footer-links">
                <a href="https://github.com/Zlovreda/Kom-Kom-Communicator" target="_blank" class="footer-link">üìÇ GitHub –ø—Ä–æ–µ–∫—Ç–∞</a>
                <a href="https://github.com/Zlovreda/Kom-Kom-Communicator/blob/main/LICENSE" target="_blank" class="footer-link">üìú Apache License 2.0</a>
                <a href="https://zlovreda.github.io/Kom-Kom-Communicator/" target="_blank" class="footer-link">üöÄ –ö–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä</a>
                <a href="https://github.com/Zlovreda" target="_blank" class="footer-link">üë§ –ê–≤—Ç–æ—Ä</a>
            </div>
            <div class="copyright">
                Copyright ¬© 2025 Pavel Nikolaevich Kopchenov ‚Ä¢ Kom-Kom Communicator ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–π –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ (AAC)
            </div>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏) -->
    <div class="modal preview-modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç–æ—á–∫–∏</h3>
                <button class="close-btn" id="closePreviewModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="card-preview-container">
                    <div class="preview-card" id="previewCard" style="background: #E3F2FD; border-color: #2196F3;">
                        <div class="preview-emoji" id="previewEmoji">üéÆ</div>
                        <div class="preview-text" id="previewText">–ò–≥—Ä–∞—Ç—å</div>
                        <div class="preview-id" id="previewId">ID</div>
                    </div>
                    
                    <div class="preview-info">
                        <h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞—Ä—Ç–æ—á–∫–µ</h4>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üé® –≠–º–æ–¥–∑–∏:</span>
                            <span class="preview-info-value" id="previewEmojiText">üéÆ</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üìù –¢–µ–∫—Å—Ç:</span>
                            <span class="preview-info-value" id="previewTextValue">–ò–≥—Ä–∞—Ç—å</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üìÅ –¢–∏–ø:</span>
                            <span class="preview-info-value" id="previewType">–¥–µ–π—Å—Ç–≤–∏–µ</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üé® –¶–≤–µ—Ç —Ñ–æ–Ω–∞:</span>
                            <span class="preview-info-value" id="previewColor">#E3F2FD</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üñºÔ∏è –¶–≤–µ—Ç —Ä–∞–º–∫–∏:</span>
                            <span class="preview-info-value" id="previewBorderColor">#2196F3</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                            <span class="preview-info-value" id="previewCategory">-</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üè∑Ô∏è –¢–µ–≥–∏:</span>
                            <span class="preview-info-value" id="previewTags">–Ω–µ—Ç</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üìä –°—Ç–∞—Ç—É—Å:</span>
                            <span class="preview-info-value" id="previewStatus">–∞–∫—Ç–∏–≤–Ω–∞</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üìà –°–ª–æ–∂–Ω–æ—Å—Ç—å:</span>
                            <span class="preview-info-value" id="previewDifficulty">1 (–æ—á–µ–Ω—å –ª–µ–≥–∫–æ)</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üì± –°–µ–∫—Ü–∏–∏:</span>
                            <span class="preview-info-value" id="previewSections">–ì–ª–∞–≤–Ω–∞—è</span>
                        </div>
                        <div class="preview-info-item">
                            <span class="preview-info-label">üî• –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π:</span>
                            <span class="preview-info-value" id="previewUsageCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closePreviewBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì• –ò–º–ø–æ—Ä—Ç –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
                <button class="close-btn" id="closeImportModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>üìÅ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª JSON:</label>
                    <input type="file" id="importFile" accept=".json" style="padding: 12px; border: 2px dashed #e2e8f0; border-radius: 12px; width: 100%; cursor: pointer;">
                </div>
                
                <div class="form-group">
                    <label>üìù –ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ JSON:</label>
                    <textarea id="importJson" placeholder='{"cards": {...}}' rows="10" style="font-family: 'JetBrains Mono', monospace;"></textarea>
                </div>
                
                <div class="form-group">
                    <label>‚öôÔ∏è –†–µ–∂–∏–º –∏–º–ø–æ—Ä—Ç–∞:</label>
                    <select id="importMode">
                        <option value="merge">üîÄ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)</option>
                        <option value="replace">üîÑ –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ</option>
                        <option value="update">üìù –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ</option>
                        <option value="add">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="validateOnImport" checked> ‚úì –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelImportBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="executeImportBtn">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
                <button class="close-btn" id="closeExportModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>üéØ –ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:</label>
                    <select id="exportScope">
                        <option value="all">üìö –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏</option>
                        <option value="selected">üë• –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</option>
                        <option value="filtered">üîç –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</option>
                        <option value="current">üìÑ –¢–µ–∫—É—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>‚öôÔ∏è –í–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="exportSystemFields" checked> ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="exportUsageCount" checked> üî• –°—á–µ—Ç—á–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>üìÅ –§–æ—Ä–º–∞—Ç:</label>
                    <select id="exportFormat">
                        <option value="json">üìù JSON (–ø–æ–ª–Ω—ã–π)</option>
                        <option value="json-min">üì¶ JSON (–º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)</option>
                        <option value="csv">üìä CSV (—Ç–∞–±–ª–∏—Ü–∞)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</label>
                    <textarea id="exportPreview" rows="6" readonly style="font-family: 'JetBrains Mono', monospace; background: #f8fafc;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExportBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="copyExportBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-success" id="downloadExportBtn">üíæ –°–∫–∞—á–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="serverLoadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üåê –ó–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞</h3>
                <button class="close-btn" id="closeServerModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>üîó URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:</label>
                    <input type="text" id="serverUrl" value="https://raw.githubusercontent.com/Zlovreda/communicator/refs/heads/main/cards.json" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e2e8f0;">
                </div>
                
                <div class="form-group">
                    <label>‚öôÔ∏è –†–µ–∂–∏–º –∑–∞–≥—Ä—É–∑–∫–∏:</label>
                    <select id="serverLoadMode">
                        <option value="merge">üîÄ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏</option>
                        <option value="replace">üîÑ –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üìä –°—Ç–∞—Ç—É—Å:</label>
                    <div id="serverStatus" style="padding: 12px; background: #f8fafc; border-radius: 10px; border: 1px solid #e2e8f0; font-family: 'JetBrains Mono', monospace; font-size: 13px;">–ì–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelServerBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="executeServerLoadBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="duplicatesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã</h3>
                <button class="close-btn" id="closeDuplicatesModal">√ó</button>
            </div>
            <div class="modal-body">
                <div id="duplicatesList">
                    <!-- –î—É–±–ª–∏–∫–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeDuplicatesBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
        document.getElementById('cardColor').addEventListener('input', function() {
            document.getElementById('colorValue').textContent = this.value;
        });
        
        document.getElementById('borderColor').addEventListener('input', function() {
            document.getElementById('borderColorValue').textContent = this.value;
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–≤–µ—Ç–æ–≤
        document.getElementById('colorValue').textContent = document.getElementById('cardColor').value;
        document.getElementById('borderColorValue').textContent = document.getElementById('borderColor').value;

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const REMOTE_CARDS_URL = 'https://raw.githubusercontent.com/Zlovreda/communicator/refs/heads/main/cards.json';
        const APP_URL = 'https://zlovreda.github.io/Kom-Kom-Communicator/';
        const STORAGE_KEY = 'komkom_cards_editor_data';
        const STORAGE_VERSION = '2.2';
        const STORAGE_METADATA_KEY = 'komkom_editor_metadata';
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let cards = {};
        let currentCardId = null;
        let selectedCards = new Set();
        let currentSort = 'text';
        let allSections = ['–ì–ª–∞–≤–Ω–∞—è', '–û–±—É—á–µ–Ω–∏–µ', '–î–∏–∞–ª–æ–≥', '–≠–º–æ—Ü–∏–∏'];
        let metadata = {
            allowedWith: [],
            allowedObjects: [],
            maxPeople: 0,
            maxPets: 0,
            maxPlaces: 0,
            maxObjects: 0
        };
        let autoSaveTimeout = null;
        let isAutoSaveEnabled = true;
        let lastSaveTimestamp = 0;
        let unsavedChanges = false;
        
        // –ö–ª–∞—Å—Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        class CardEditor {
            constructor() {
                this.loadCards();
                this.loadMetadata();
                this.initEventListeners();
                this.populateFilters();
                this.renderCardList();
                this.updateCounters();
                this.setupAutoSave();
                this.updateMiniPreview();
                this.updateLastSaveTime();
                
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é
                this.restoreSession();
                
                // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
                window.addEventListener('beforeunload', (e) => {
                    if (unsavedChanges && isAutoSaveEnabled) {
                        this.saveCurrentCard(true);
                        e.preventDefault();
                        e.returnValue = '';
                    }
                });
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–∑ localStorage
            loadCards() {
                try {
                    const savedData = localStorage.getItem(STORAGE_KEY);
                    if (savedData) {
                        const parsed = JSON.parse(savedData);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
                        if (parsed.version === STORAGE_VERSION) {
                            cards = parsed.cards || parsed.data || {};
                            console.log('‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage:', Object.keys(cards).length);
                            
                            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            if (parsed.lastModified) {
                                lastSaveTimestamp = parsed.lastModified;
                                this.updateLastSaveTime();
                            }
                        } else {
                            console.log('‚ö†Ô∏è –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–µ—Ä—Å–∏—è –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞');
                            cards = {};
                        }
                    } else {
                        cards = {};
                        console.log('‚ÑπÔ∏è –ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞');
                    }
                } catch (e) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫:', e);
                    cards = {};
                }
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            loadMetadata() {
                try {
                    const savedMetadata = localStorage.getItem(STORAGE_METADATA_KEY);
                    if (savedMetadata) {
                        const parsed = JSON.parse(savedMetadata);
                        isAutoSaveEnabled = parsed.autoSaveEnabled !== false;
                        document.getElementById('autosaveToggle').checked = isAutoSaveEnabled;
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
                        if (parsed.filters) {
                            document.getElementById('typeFilter').value = parsed.filters.type || '';
                            document.getElementById('sortSelect').value = parsed.filters.sort || 'text';
                        }
                    }
                } catch (e) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:', e);
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            saveMetadata() {
                const metadata = {
                    autoSaveEnabled: isAutoSaveEnabled,
                    filters: {
                        type: document.getElementById('typeFilter').value,
                        sort: document.getElementById('sortSelect').value
                    },
                    lastOpened: Date.now()
                };
                
                localStorage.setItem(STORAGE_METADATA_KEY, JSON.stringify(metadata));
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ localStorage
            saveCards() {
                const dataToSave = {
                    version: STORAGE_VERSION,
                    cards: cards,
                    lastModified: Date.now(),
                    count: Object.keys(cards).length,
                    exportDate: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                    lastSaveTimestamp = dataToSave.lastModified;
                    this.updateLastSaveTime();
                    this.saveMetadata();
                    unsavedChanges = false;
                    
                    console.log('üíæ –ö–∞—Ä—Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
                } catch (e) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫:', e);
                    this.showSaveStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                }
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
            restoreSession() {
                const sessionData = localStorage.getItem('komkom_editor_session');
                if (sessionData) {
                    try {
                        const session = JSON.parse(sessionData);
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                        if (session.currentCardId && cards[session.currentCardId]) {
                            setTimeout(() => {
                                this.loadCard(session.currentCardId);
                            }, 100);
                        }
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∏—Å–∫
                        if (session.search) {
                            document.getElementById('searchInput').value = session.search;
                        }
                        
                        // –£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é
                        localStorage.removeItem('komkom_editor_session');
                    } catch (e) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏:', e);
                    }
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
            saveSession() {
                const session = {
                    currentCardId: currentCardId,
                    search: document.getElementById('searchInput').value,
                    timestamp: Date.now()
                };
                
                localStorage.setItem('komkom_editor_session', JSON.stringify(session));
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            updateLastSaveTime() {
                const element = document.getElementById('lastSaveTime');
                if (!element) return;
                
                if (lastSaveTimestamp === 0) {
                    element.textContent = '–ù–∏–∫–æ–≥–¥–∞';
                    return;
                }
                
                const now = Date.now();
                const diff = Math.floor((now - lastSaveTimestamp) / 1000);
                
                if (diff < 60) {
                    element.textContent = '–¢–æ–ª—å–∫–æ —á—Ç–æ';
                } else if (diff < 3600) {
                    const minutes = Math.floor(diff / 60);
                    element.textContent = `${minutes} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                } else if (diff < 86400) {
                    const hours = Math.floor(diff / 3600);
                    element.textContent = `${hours} —á –Ω–∞–∑–∞–¥`;
                } else {
                    const date = new Date(lastSaveTimestamp);
                    element.textContent = date.toLocaleString('ru-RU', {
                        day: '2-digit',
                        month: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            showSaveStatus(message, type = 'success') {
                const saveStatus = document.getElementById('saveStatus');
                saveStatus.textContent = message;
                saveStatus.className = '';
                saveStatus.classList.add(type);
                saveStatus.style.display = 'block';
                saveStatus.style.opacity = '1';
                
                setTimeout(() => {
                    saveStatus.style.opacity = '0';
                    setTimeout(() => {
                        saveStatus.style.display = 'none';
                    }, 300);
                }, 3000);
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            setupAutoSave() {
                // –ù–∞ –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã –≤–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                const formElements = document.querySelectorAll('#editorForm input, #editorForm select, #editorForm textarea');
                formElements.forEach(element => {
                    element.addEventListener('input', () => {
                        unsavedChanges = true;
                        if (isAutoSaveEnabled) this.triggerAutoSave();
                    });
                    element.addEventListener('change', () => {
                        unsavedChanges = true;
                        if (isAutoSaveEnabled) this.triggerAutoSave();
                    });
                });
                
                // JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä
                document.getElementById('jsonEditor').addEventListener('input', () => {
                    unsavedChanges = true;
                    if (isAutoSaveEnabled) this.triggerAutoSave();
                });
                
                // –ö–Ω–æ–ø–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
                document.querySelectorAll('.metadata-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        unsavedChanges = true;
                        if (isAutoSaveEnabled) this.triggerAutoSave();
                    });
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                document.getElementById('autosaveToggle').addEventListener('change', (e) => {
                    isAutoSaveEnabled = e.target.checked;
                    this.saveMetadata();
                    this.showSaveStatus(isAutoSaveEnabled ? '‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ' : '‚≠ï –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ', 'success');
                });
            }
            
            // –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            triggerAutoSave() {
                if (!isAutoSaveEnabled) return;
                
                if (autoSaveTimeout) {
                    clearTimeout(autoSaveTimeout);
                }
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                this.showSaveStatus('‚è≥ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...', 'saving');
                
                autoSaveTimeout = setTimeout(() => {
                    if (currentCardId) {
                        this.saveCurrentCard(true);
                    }
                }, 1500);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            initEventListeners() {
                // –ö–Ω–æ–ø–∫–∏ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
                document.getElementById('addCardBtn').addEventListener('click', () => this.addNewCard());
                document.getElementById('saveCardBtn').addEventListener('click', () => this.saveCurrentCard());
                document.getElementById('duplicateBtn').addEventListener('click', () => this.duplicateCard());
                document.getElementById('deleteCardBtn').addEventListener('click', () => this.deleteCard());
                document.getElementById('previewBtn').addEventListener('click', () => this.showPreviewModal());
                document.getElementById('findDuplicatesBtn').addEventListener('click', () => this.findDuplicates());
                document.getElementById('importBtn').addEventListener('click', () => this.showImportModal());
                document.getElementById('exportBtn').addEventListener('click', () => this.showExportModal());
                document.getElementById('loadFromServerBtn').addEventListener('click', () => this.showServerLoadModal());
                document.getElementById('validateBtn').addEventListener('click', () => this.validateCards());
                
                // –ú–∏–Ω–∏-–ø—Ä–µ–≤—å—é
                document.getElementById('miniPreview').addEventListener('click', () => this.showPreviewModal());
                
                // –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
                document.getElementById('searchInput').addEventListener('input', () => {
                    this.renderCardList();
                    if (isAutoSaveEnabled) this.saveMetadata();
                });
                document.getElementById('typeFilter').addEventListener('change', () => {
                    this.renderCardList();
                    if (isAutoSaveEnabled) this.saveMetadata();
                });
                document.getElementById('sortSelect').addEventListener('change', () => {
                    currentSort = document.getElementById('sortSelect').value;
                    this.renderCardList();
                    if (isAutoSaveEnabled) this.saveMetadata();
                });
                
                // –ö–Ω–æ–ø–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                document.querySelectorAll('.sort-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const sort = e.target.dataset.sort;
                        document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        currentSort = sort;
                        this.renderCardList();
                        if (isAutoSaveEnabled) this.saveMetadata();
                    });
                });
                
                // –†–µ–¥–∞–∫—Ç–æ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
                document.querySelectorAll('.metadata-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const field = e.target.dataset.field;
                        const value = e.target.dataset.value;
                        this.toggleMetadataValue(field, value, e.target);
                        unsavedChanges = true;
                        if (isAutoSaveEnabled) this.triggerAutoSave();
                    });
                });
                
                // –ü–æ–ª—è –ª–∏–º–∏—Ç–æ–≤
                ['maxPeople', 'maxPets', 'maxPlaces', 'maxObjects'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => {
                        this.updateMetadataFromUI();
                        unsavedChanges = true;
                        if (isAutoSaveEnabled) this.triggerAutoSave();
                    });
                });
                
                // –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤
                document.getElementById('objectSearch').addEventListener('input', () => this.renderObjectsGrid());
                document.getElementById('clearObjectsBtn').addEventListener('click', () => this.clearSelectedObjects());
                
                // JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä
                document.getElementById('jsonEditor').addEventListener('input', () => {
                    this.updateMetadataFromJson();
                    unsavedChanges = true;
                    if (isAutoSaveEnabled) this.triggerAutoSave();
                });
                
                // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
                const previewFields = ['cardId', 'cardText', 'cardEmoji', 'cardType', 'cardCategory', 
                                     'cardColor', 'borderColor', 'cardTags', 'status', 'difficulty', 'usageCount'];
                
                previewFields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) {
                        element.addEventListener('input', () => {
                            this.updateMiniPreview();
                            this.updatePreviewModal();
                            unsavedChanges = true;
                            if (isAutoSaveEnabled) this.triggerAutoSave();
                        });
                        element.addEventListener('change', () => {
                            this.updateMiniPreview();
                            this.updatePreviewModal();
                            unsavedChanges = true;
                            if (isAutoSaveEnabled) this.triggerAutoSave();
                        });
                    }
                });
                
                // –°–µ–∫—Ü–∏–∏
                document.getElementById('sectionsCheckbox').addEventListener('change', () => {
                    this.updatePreviewModal();
                    unsavedChanges = true;
                    if (isAutoSaveEnabled) this.triggerAutoSave();
                });
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è ID
                document.getElementById('cardId').addEventListener('blur', () => this.validateCardId());
                document.getElementById('cardType').addEventListener('change', () => this.onCardTypeChange());
                
                // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                this.initModalEvents();
                
                // –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –≤—ã–±–æ—Ä–∞
                document.getElementById('resetSelectionBtn').addEventListener('click', () => this.resetSelection());
                
                // –ö–Ω–æ–ø–∫–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                document.getElementById('bulkAddTagBtn').addEventListener('click', () => this.bulkAddTag());
                document.getElementById('bulkRemoveTagBtn').addEventListener('click', () => this.bulkRemoveTag());
                document.getElementById('bulkChangeStatusBtn').addEventListener('click', () => this.bulkChangeStatus());
                document.getElementById('bulkChangeCategoryBtn').addEventListener('click', () => this.bulkChangeCategory());
                document.getElementById('applyBulkBtn').addEventListener('click', () => this.applyBulkChanges());
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            initModalEvents() {
                // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                document.getElementById('closePreviewModal').addEventListener('click', () => {
                    document.getElementById('previewModal').classList.remove('active');
                });
                document.getElementById('closePreviewBtn').addEventListener('click', () => {
                    document.getElementById('previewModal').classList.remove('active');
                });
                
                // –ò–º–ø–æ—Ä—Ç
                document.getElementById('closeImportModal').addEventListener('click', () => {
                    document.getElementById('importModal').classList.remove('active');
                });
                document.getElementById('cancelImportBtn').addEventListener('click', () => {
                    document.getElementById('importModal').classList.remove('active');
                });
                document.getElementById('executeImportBtn').addEventListener('click', () => this.executeImport());
                document.getElementById('importFile').addEventListener('change', (e) => this.handleFileImport(e));
                
                // –≠–∫—Å–ø–æ—Ä—Ç
                document.getElementById('closeExportModal').addEventListener('click', () => {
                    document.getElementById('exportModal').classList.remove('active');
                });
                document.getElementById('cancelExportBtn').addEventListener('click', () => {
                    document.getElementById('exportModal').classList.remove('active');
                });
                document.getElementById('copyExportBtn').addEventListener('click', () => this.copyExport());
                document.getElementById('downloadExportBtn').addEventListener('click', () => this.downloadExport());
                document.getElementById('exportScope').addEventListener('change', () => this.updateExportPreview());
                document.getElementById('exportFormat').addEventListener('change', () => this.updateExportPreview());
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
                document.getElementById('closeServerModal').addEventListener('click', () => {
                    document.getElementById('serverLoadModal').classList.remove('active');
                });
                document.getElementById('cancelServerBtn').addEventListener('click', () => {
                    document.getElementById('serverLoadModal').classList.remove('active');
                });
                document.getElementById('executeServerLoadBtn').addEventListener('click', () => this.loadFromServer());
                
                // –î—É–±–ª–∏–∫–∞—Ç—ã
                document.getElementById('closeDuplicatesModal').addEventListener('click', () => {
                    document.getElementById('duplicatesModal').classList.remove('active');
                });
                document.getElementById('closeDuplicatesBtn').addEventListener('click', () => {
                    document.getElementById('duplicatesModal').classList.remove('active');
                });
            }
            
            // –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫
            resetSelection() {
                selectedCards.clear();
                this.renderCardList();
                this.updateBulkEditSection();
                this.showSaveStatus('üóëÔ∏è –í—ã–±–æ—Ä —Å–±—Ä–æ—à–µ–Ω', 'success');
            }
            
            // –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞
            bulkAddTag() {
                if (selectedCards.size === 0) {
                    this.showSaveStatus('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏!', 'error');
                    return;
                }
                
                const tag = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:');
                if (!tag) return;
                
                let count = 0;
                selectedCards.forEach(cardId => {
                    if (cards[cardId]) {
                        if (!cards[cardId].tags) {
                            cards[cardId].tags = [];
                        }
                        if (!cards[cardId].tags.includes(tag)) {
                            cards[cardId].tags.push(tag);
                            count++;
                        }
                    }
                });
                
                this.saveCards();
                this.renderCardList();
                this.showSaveStatus(`‚úÖ –¢–µ–≥ "${tag}" –¥–æ–±–∞–≤–ª–µ–Ω –∫ ${count} –∫–∞—Ä—Ç–æ—á–∫–∞–º`, 'success');
            }
            
            // –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–≥–∞
            bulkRemoveTag() {
                if (selectedCards.size === 0) {
                    this.showSaveStatus('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏!', 'error');
                    return;
                }
                
                const tag = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:');
                if (!tag) return;
                
                let count = 0;
                selectedCards.forEach(cardId => {
                    if (cards[cardId] && cards[cardId].tags) {
                        const index = cards[cardId].tags.indexOf(tag);
                        if (index !== -1) {
                            cards[cardId].tags.splice(index, 1);
                            count++;
                            
                            // –ï—Å–ª–∏ —Ç–µ–≥–æ–≤ –±–æ–ª—å—à–µ –Ω–µ—Ç, —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ
                            if (cards[cardId].tags.length === 0) {
                                delete cards[cardId].tags;
                            }
                        }
                    }
                });
                
                this.saveCards();
                this.renderCardList();
                this.showSaveStatus(`‚úÖ –¢–µ–≥ "${tag}" —É–¥–∞–ª–µ–Ω –∏–∑ ${count} –∫–∞—Ä—Ç–æ—á–µ–∫`, 'success');
            }
            
            // –ú–∞—Å—Å–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            bulkChangeStatus() {
                if (selectedCards.size === 0) {
                    this.showSaveStatus('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏!', 'error');
                    return;
                }
                
                const status = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å (active, disabled, hidden, draft):', 'active');
                if (!status) return;
                
                const validStatuses = ['active', 'disabled', 'hidden', 'draft'];
                if (!validStatuses.includes(status)) {
                    this.showSaveStatus('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Å—Ç–∞—Ç—É—Å!', 'error');
                    return;
                }
                
                let count = 0;
                selectedCards.forEach(cardId => {
                    if (cards[cardId]) {
                        cards[cardId].status = status;
                        count++;
                    }
                });
                
                this.saveCards();
                this.renderCardList();
                this.showSaveStatus(`‚úÖ –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω —É ${count} –∫–∞—Ä—Ç–æ—á–µ–∫`, 'success');
            }
            
            // –ú–∞—Å—Å–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            bulkChangeCategory() {
                if (selectedCards.size === 0) {
                    this.showSaveStatus('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏!', 'error');
                    return;
                }
                
                const category = prompt('–í–≤–µ–¥–∏—Ç–µ ID –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏):');
                
                let count = 0;
                selectedCards.forEach(cardId => {
                    if (cards[cardId]) {
                        if (category === '') {
                            delete cards[cardId].category;
                        } else {
                            cards[cardId].category = category;
                        }
                        count++;
                    }
                });
                
                this.saveCards();
                this.renderCardList();
                this.showSaveStatus(`‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∞ —É ${count} –∫–∞—Ä—Ç–æ—á–µ–∫`, 'success');
            }
            
            // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞—Å—Å–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            applyBulkChanges() {
                this.saveCards();
                this.showSaveStatus(`‚úÖ –ú–∞—Å—Å–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ ${selectedCards.size} –∫–∞—Ä—Ç–æ—á–∫–∞–º`, 'success');
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–Ω–∏-–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            updateMiniPreview() {
                const miniPreview = document.getElementById('miniPreview');
                const miniEmoji = document.getElementById('miniPreviewEmoji');
                
                const emoji = document.getElementById('cardEmoji').value || 'üìÑ';
                const color = document.getElementById('cardColor').value;
                const borderColor = document.getElementById('borderColor').value;
                
                miniPreview.style.background = color;
                miniPreview.style.borderColor = borderColor;
                miniEmoji.textContent = emoji;
                
                // –û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                document.getElementById('colorValue').textContent = color;
                document.getElementById('borderColorValue').textContent = borderColor;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            updatePreviewModal() {
                const text = document.getElementById('cardText').value || '–¢–µ–∫—Å—Ç';
                const emoji = document.getElementById('cardEmoji').value || 'üìÑ';
                const color = document.getElementById('cardColor').value;
                const borderColor = document.getElementById('borderColor').value;
                const id = document.getElementById('cardId').value || 'ID';
                const type = document.getElementById('cardType').value;
                const category = document.getElementById('cardCategory').value;
                const tags = document.getElementById('cardTags').value;
                const status = document.getElementById('status').value;
                const difficulty = document.getElementById('difficulty').value;
                const usageCount = document.getElementById('usageCount').value;
                
                // –°–µ–∫—Ü–∏–∏
                const sections = [];
                document.querySelectorAll('#sectionsCheckbox input:checked').forEach(checkbox => {
                    sections.push(checkbox.value);
                });
                
                // –û–±–Ω–æ–≤–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–∞—Ä—Ç–æ—á–∫–∏
                const previewCard = document.getElementById('previewCard');
                previewCard.style.background = color;
                previewCard.style.borderColor = borderColor;
                document.getElementById('previewEmoji').textContent = emoji;
                document.getElementById('previewText').textContent = text;
                document.getElementById('previewId').textContent = id;
                
                // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å–ø—Ä–∞–≤–∞
                document.getElementById('previewEmojiText').textContent = emoji;
                document.getElementById('previewTextValue').textContent = text;
                document.getElementById('previewType').textContent = this.getTypeName(type);
                document.getElementById('previewColor').textContent = color;
                document.getElementById('previewBorderColor').textContent = borderColor;
                document.getElementById('previewCategory').textContent = category ? 
                    (cards[category]?.text || category) : '-';
                document.getElementById('previewTags').textContent = tags || '–Ω–µ—Ç';
                document.getElementById('previewStatus').textContent = this.getStatusName(status);
                document.getElementById('previewDifficulty').textContent = difficulty + ' ' + this.getDifficultyName(difficulty);
                document.getElementById('previewSections').textContent = sections.length > 0 ? sections.join(', ') : '–Ω–µ—Ç';
                document.getElementById('previewUsageCount').textContent = usageCount;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            showPreviewModal() {
                this.updatePreviewModal();
                document.getElementById('previewModal').classList.add('active');
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞
            getTypeName(type) {
                const typeNames = {
                    'category': '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
                    'action': '–î–µ–π—Å—Ç–≤–∏–µ',
                    'object': '–û–±—ä–µ–∫—Ç',
                    'person': '–ß–µ–ª–æ–≤–µ–∫',
                    'place': '–ú–µ—Å—Ç–æ',
                    'emotion': '–≠–º–æ—Ü–∏—è',
                    'pain': '–ë–æ–ª—å',
                    'time': '–í—Ä–µ–º—è',
                    'dialog': '–î–∏–∞–ª–æ–≥',
                    'learning': '–û–±—É—á–µ–Ω–∏–µ',
                    'color': '–¶–≤–µ—Ç',
                    'help': '–ü–æ–º–æ—â—å',
                    'request': '–ó–∞–ø—Ä–æ—Å'
                };
                return typeNames[type] || type;
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            getStatusName(status) {
                const statusNames = {
                    'active': '‚úÖ –ê–∫—Ç–∏–≤–Ω–∞',
                    'disabled': '‚≠ï –û—Ç–∫–ª—é—á–µ–Ω–∞',
                    'hidden': 'üëÅÔ∏è‚Äçüó®Ô∏è –°–∫—Ä—ã—Ç–∞',
                    'draft': 'üìù –ß–µ—Ä–Ω–æ–≤–∏–∫'
                };
                return statusNames[status] || status;
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            getDifficultyName(level) {
                const difficultyNames = {
                    '1': '(–æ—á–µ–Ω—å –ª–µ–≥–∫–æ)',
                    '2': '(–ª–µ–≥–∫–æ)',
                    '3': '(—Å—Ä–µ–¥–Ω–µ)',
                    '4': '(—Å–ª–æ–∂–Ω–æ)',
                    '5': '(–æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ)'
                };
                return difficultyNames[level] || '';
            }
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            populateFilters() {
                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                const categorySelect = document.getElementById('cardCategory');
                categorySelect.innerHTML = '<option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
                
                Object.values(cards).forEach(card => {
                    if (card.type === 'category') {
                        const option = document.createElement('option');
                        option.value = card.id;
                        option.textContent = `${card.emoji || 'üìÅ'} ${card.text} (${card.id})`;
                        categorySelect.appendChild(option);
                    }
                });
                
                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π
                const sectionsContainer = document.getElementById('sectionsCheckbox');
                sectionsContainer.innerHTML = '';
                
                allSections.forEach(section => {
                    const label = document.createElement('label');
                    label.className = 'checkbox-item';
                    label.innerHTML = `
                        <input type="checkbox" value="${section}"> ${section}
                    `;
                    sectionsContainer.appendChild(label);
                });
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
            renderCardList() {
                const cardList = document.getElementById('cardList');
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const typeFilter = document.getElementById('typeFilter').value;
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
                let filteredCards = Object.values(cards);
                
                if (searchTerm) {
                    filteredCards = filteredCards.filter(card => 
                        card.id.toLowerCase().includes(searchTerm) ||
                        card.text.toLowerCase().includes(searchTerm) ||
                        (card.tags && card.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                    );
                }
                
                if (typeFilter) {
                    filteredCards = filteredCards.filter(card => card.type === typeFilter);
                }
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
                filteredCards.sort((a, b) => {
                    switch (currentSort) {
                        case 'text':
                            return a.text.localeCompare(b.text);
                        case 'text-desc':
                            return b.text.localeCompare(a.text);
                        case 'id':
                            return a.id.localeCompare(b.id);
                        case 'type':
                            return a.type.localeCompare(b.type);
                        case 'usageCount':
                            return (b.usageCount || 0) - (a.usageCount || 0);
                        case 'created':
                            return new Date(b.created || 0) - new Date(a.created || 0);
                        default:
                            return a.text.localeCompare(b.text);
                    }
                });
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
                cardList.innerHTML = '';
                
                if (filteredCards.length === 0) {
                    const emptyItem = document.createElement('li');
                    emptyItem.className = 'card-list-item';
                    emptyItem.style.textAlign = 'center';
                    emptyItem.style.padding = '40px 20px';
                    emptyItem.innerHTML = `
                        <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
                        <div class="card-text" style="text-align: center; color: #64748b; font-size: 16px;">
                            –ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                        </div>
                        <div style="font-size: 14px; color: #94a3b8; margin-top: 8px;">
                            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                        </div>
                    `;
                    cardList.appendChild(emptyItem);
                    return;
                }
                
                filteredCards.forEach(card => {
                    const li = document.createElement('li');
                    li.className = `card-list-item ${currentCardId === card.id ? 'selected' : ''}`;
                    li.dataset.id = card.id;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —ç—Ç–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
                    const isSelected = selectedCards.has(card.id);
                    
                    li.innerHTML = `
                        <input type="checkbox" class="card-checkbox" ${isSelected ? 'checked' : ''}>
                        <div class="card-emoji">${card.emoji || 'üìÑ'}</div>
                        <div class="card-text">${card.text}</div>
                        <div class="card-id">${card.id}</div>
                    `;
                    
                    li.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('card-checkbox')) {
                            this.loadCard(card.id);
                        }
                    });
                    
                    const checkbox = li.querySelector('.card-checkbox');
                    checkbox.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.toggleCardSelection(card.id, checkbox.checked);
                    });
                    
                    cardList.appendChild(li);
                });
                
                this.updateCounters();
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            loadCard(cardId) {
                const card = cards[cardId];
                if (!card) return;
                
                currentCardId = cardId;
                this.renderCardList();
                
                // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
                document.getElementById('cardId').value = card.id;
                document.getElementById('cardText').value = card.text || '';
                document.getElementById('cardEmoji').value = card.emoji || '';
                document.getElementById('cardType').value = card.type || 'object';
                document.getElementById('cardCategory').value = card.category || '';
                document.getElementById('cardColor').value = card.color || '#E3F2FD';
                document.getElementById('borderColor').value = card.borderColor || card.color || '#2196F3';
                document.getElementById('cardTags').value = card.tags ? card.tags.join(', ') : '';
                document.getElementById('difficulty').value = card.difficulty || 1;
                document.getElementById('status').value = card.status || 'active';
                document.getElementById('usageCount').value = card.usageCount || 0;
                document.getElementById('author').value = card.author || 'user';
                document.getElementById('version').value = card.version || 1;
                document.getElementById('description').value = card.metadata?.description || '';
                document.getElementById('createdDate').value = card.created || new Date().toISOString().slice(0, 19).replace('T', ' ');
                document.getElementById('modifiedDate').value = card.modified || new Date().toISOString().slice(0, 19).replace('T', ' ');
                
                // –°–µ–∫—Ü–∏–∏
                document.querySelectorAll('#sectionsCheckbox input').forEach(checkbox => {
                    checkbox.checked = card.sections?.includes(checkbox.value) || false;
                });
                
                // –§–æ—Ä–º—ã —Å–ª–æ–≤
                const forms = card.forms || {};
                document.getElementById('formAccusative').value = forms.accusative || '';
                document.getElementById('formGenitive').value = forms.genitive || '';
                document.getElementById('formDative').value = forms.dative || '';
                document.getElementById('formInstrumental').value = forms.instrumental || '';
                document.getElementById('formPrepositional').value = forms.prepositional || '';
                document.getElementById('formWith').value = forms.with || '';
                document.getElementById('formIn').value = forms.in || '';
                document.getElementById('formOn').value = forms.on || '';
                
                // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                this.loadMetadataCard(card.metadata || {});
                
                // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                this.updateMiniPreview();
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –º–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ
                this.updateBulkEditSection();
                
                // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é
                this.saveSession();
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                this.showSaveStatus(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${card.text}`, 'success');
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∏
            loadMetadataCard(metadataObj) {
                metadata = {
                    allowedWith: metadataObj.allowedWith || [],
                    allowedObjects: metadataObj.allowedObjects || [],
                    maxPeople: metadataObj.maxPeople || 0,
                    maxPets: metadataObj.maxPets || 0,
                    maxPlaces: metadataObj.maxPlaces || 0,
                    maxObjects: metadataObj.maxObjects || 0
                };
                
                // –ö–Ω–æ–ø–∫–∏ allowedWith
                document.querySelectorAll('.metadata-btn[data-field="allowedWith"]').forEach(btn => {
                    const value = btn.dataset.value;
                    btn.classList.toggle('active', metadata.allowedWith.includes(value));
                });
                
                // –ü–æ–ª—è –ª–∏–º–∏—Ç–æ–≤
                document.getElementById('maxPeople').value = metadata.maxPeople;
                document.getElementById('maxPets').value = metadata.maxPets;
                document.getElementById('maxPlaces').value = metadata.maxPlaces;
                document.getElementById('maxObjects').value = metadata.maxObjects;
                
                // –û–±–Ω–æ–≤–∏—Ç—å JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä
                this.updateJsonEditor();
                
                // –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É –æ–±—ä–µ–∫—Ç–æ–≤
                this.renderObjectsGrid();
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            saveCurrentCard(autoSave = false) {
                if (!currentCardId) {
                    if (!autoSave) {
                        this.showSaveStatus('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                    }
                    return;
                }
                
                const card = cards[currentCardId] || {};
                if (!card) return;
                
                // –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
                card.id = document.getElementById('cardId').value;
                card.text = document.getElementById('cardText').value;
                card.emoji = document.getElementById('cardEmoji').value;
                card.type = document.getElementById('cardType').value;
                card.category = document.getElementById('cardCategory').value;
                card.color = document.getElementById('cardColor').value;
                card.borderColor = document.getElementById('borderColor').value;
                
                // –¢–µ–≥–∏
                const tagsText = document.getElementById('cardTags').value;
                card.tags = tagsText.split(',').map(tag => tag.trim()).filter(tag => tag);
                
                card.difficulty = parseInt(document.getElementById('difficulty').value);
                card.status = document.getElementById('status').value;
                card.usageCount = parseInt(document.getElementById('usageCount').value) || 0;
                card.author = document.getElementById('author').value;
                card.version = parseInt(document.getElementById('version').value);
                
                // –î–∞—Ç—ã
                if (!card.created) {
                    card.created = new Date().toISOString();
                }
                card.modified = new Date().toISOString();
                
                // –°–µ–∫—Ü–∏–∏
                card.sections = [];
                document.querySelectorAll('#sectionsCheckbox input:checked').forEach(checkbox => {
                    card.sections.push(checkbox.value);
                });
                
                // –§–æ—Ä–º—ã —Å–ª–æ–≤
                card.forms = {
                    accusative: document.getElementById('formAccusative').value || undefined,
                    genitive: document.getElementById('formGenitive').value || undefined,
                    dative: document.getElementById('formDative').value || undefined,
                    instrumental: document.getElementById('formInstrumental').value || undefined,
                    prepositional: document.getElementById('formPrepositional').value || undefined,
                    with: document.getElementById('formWith').value || undefined,
                    in: document.getElementById('formIn').value || undefined,
                    on: document.getElementById('formOn').value || undefined
                };
                
                // –£–¥–∞–ª–∏—Ç—å –ø—É—Å—Ç—ã–µ —Ñ–æ—Ä–º—ã
                Object.keys(card.forms).forEach(key => {
                    if (!card.forms[key]) delete card.forms[key];
                });
                if (Object.keys(card.forms).length === 0) {
                    delete card.forms;
                }
                
                // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                card.metadata = {
                    ...metadata,
                    description: document.getElementById('description').value || undefined
                };
                
                // –û—á–∏—Å—Ç–∏—Ç—å –ø—É—Å—Ç—ã–µ –ø–æ–ª—è
                if (!card.metadata.description) delete card.metadata.description;
                
                // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É
                cards[card.id] = card;
                
                // –ï—Å–ª–∏ ID –∏–∑–º–µ–Ω–∏–ª—Å—è
                if (currentCardId !== card.id) {
                    delete cards[currentCardId];
                    currentCardId = card.id;
                }
                
                this.saveCards();
                this.populateFilters();
                this.renderCardList();
                
                if (!autoSave) {
                    this.showSaveStatus('üíæ –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
                } else {
                    this.showSaveStatus('‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ', 'success');
                }
                
                unsavedChanges = false;
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
            toggleCardSelection(cardId, isSelected) {
                if (isSelected) {
                    selectedCards.add(cardId);
                } else {
                    selectedCards.delete(cardId);
                }
                
                this.updateCounters();
                this.updateBulkEditSection();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
            updateCounters() {
                const total = Object.keys(cards).length;
                document.getElementById('cardCount').textContent = `üìö –í—Å–µ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ${total}`;
                document.getElementById('selectedCount').textContent = `üë• –í—ã–±—Ä–∞–Ω–æ: ${selectedCards.size}`;
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                if (unsavedChanges) {
                    document.getElementById('saveStatus').textContent = '‚úèÔ∏è –ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                    document.getElementById('saveStatus').className = 'saving';
                    document.getElementById('saveStatus').style.display = 'block';
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            updateJsonEditor() {
                const jsonEditor = document.getElementById('jsonEditor');
                const jsonString = JSON.stringify(metadata, null, 2);
                jsonEditor.textContent = jsonString;
                this.highlightJson(jsonEditor);
            }
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ JSON
            highlightJson(element) {
                const text = element.textContent;
                let highlighted = text
                    .replace(/("[\w]+"):/g, '<span class="json-key">$1</span>:')
                    .replace(/: ("[^"]*")/g, ': <span class="json-string">$1</span>')
                    .replace(/: ([\d\.]+)/g, ': <span class="json-number">$1</span>')
                    .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                    .replace(/: null/g, ': <span class="json-null">null</span>');
                
                element.innerHTML = highlighted;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ UI
            updateMetadataFromUI() {
                // –û–±–Ω–æ–≤–∏—Ç—å allowedWith –∏–∑ –∫–Ω–æ–ø–æ–∫
                metadata.allowedWith = [];
                document.querySelectorAll('.metadata-btn[data-field="allowedWith"].active').forEach(btn => {
                    metadata.allowedWith.push(btn.dataset.value);
                });
                
                // –û–±–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç—ã
                metadata.maxPeople = parseInt(document.getElementById('maxPeople').value) || 0;
                metadata.maxPets = parseInt(document.getElementById('maxPets').value) || 0;
                metadata.maxPlaces = parseInt(document.getElementById('maxPlaces').value) || 0;
                metadata.maxObjects = parseInt(document.getElementById('maxObjects').value) || 0;
                
                // –û–±–Ω–æ–≤–∏—Ç—å JSON
                this.updateJsonEditor();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            updateMetadataFromJson() {
                try {
                    const jsonText = document.getElementById('jsonEditor').textContent;
                    const newMetadata = JSON.parse(jsonText);
                    metadata = newMetadata;
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å UI
                    document.querySelectorAll('.metadata-btn[data-field="allowedWith"]').forEach(btn => {
                        const value = btn.dataset.value;
                        btn.classList.toggle('active', metadata.allowedWith.includes(value));
                    });
                    
                    document.getElementById('maxPeople').value = metadata.maxPeople || 0;
                    document.getElementById('maxPets').value = metadata.maxPets || 0;
                    document.getElementById('maxPlaces').value = metadata.maxPlaces || 0;
                    document.getElementById('maxObjects').value = metadata.maxObjects || 0;
                    
                    this.renderObjectsGrid();
                } catch (e) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', e);
                    this.showSaveStatus('‚ùå –û—à–∏–±–∫–∞ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ', 'error');
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤
            renderObjectsGrid() {
                const searchTerm = document.getElementById('objectSearch').value.toLowerCase();
                const objectsGrid = document.getElementById('objectsGrid');
                
                // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã
                let objectCards = Object.values(cards).filter(card => 
                    card.type === 'object' || card.type === 'clothing' || card.type === 'book' || card.type === 'creative'
                );
                
                // –ü–æ–∏—Å–∫
                if (searchTerm) {
                    objectCards = objectCards.filter(card => 
                        card.text.toLowerCase().includes(searchTerm) ||
                        card.id.toLowerCase().includes(searchTerm) ||
                        (card.tags && card.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                    );
                }
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
                objectCards.sort((a, b) => a.text.localeCompare(b.text));
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
                objectsGrid.innerHTML = '';
                
                if (objectCards.length === 0) {
                    objectsGrid.innerHTML = `
                        <div style="text-align: center; color: #64748b; grid-column: 1 / -1; padding: 40px 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üì¶</div>
                            <div>–û–±—ä–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                            <div style="font-size: 13px; color: #94a3b8; margin-top: 8px;">
                                ${searchTerm ? '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å' : '–°–æ–∑–¥–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ'}
                            </div>
                        </div>
                    `;
                    return;
                }
                
                objectCards.forEach(card => {
                    const isSelected = metadata.allowedObjects.includes(card.id);
                    const div = document.createElement('div');
                    div.className = `object-item ${isSelected ? 'selected' : ''}`;
                    div.dataset.id = card.id;
                    div.innerHTML = `
                        <div class="emoji">${card.emoji || 'üì¶'}</div>
                        ${card.text}
                    `;
                    
                    div.addEventListener('click', () => {
                        this.toggleAllowedObject(card.id);
                        unsavedChanges = true;
                        if (isAutoSaveEnabled) this.triggerAutoSave();
                    });
                    
                    objectsGrid.appendChild(div);
                });
                
                // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
                document.getElementById('selectedObjectsCount').textContent = metadata.allowedObjects.length;
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≤ allowedObjects
            toggleAllowedObject(cardId) {
                const index = metadata.allowedObjects.indexOf(cardId);
                if (index === -1) {
                    metadata.allowedObjects.push(cardId);
                    this.showSaveStatus(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—ä–µ–∫—Ç: ${cards[cardId]?.text}`, 'success');
                } else {
                    metadata.allowedObjects.splice(index, 1);
                    this.showSaveStatus(`‚ûñ –£–¥–∞–ª–µ–Ω –æ–±—ä–µ–∫—Ç: ${cards[cardId]?.text}`, 'success');
                }
                
                this.updateJsonEditor();
                this.renderObjectsGrid();
            }
            
            // –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
            clearSelectedObjects() {
                metadata.allowedObjects = [];
                this.updateJsonEditor();
                this.renderObjectsGrid();
                unsavedChanges = true;
                if (isAutoSaveEnabled) this.triggerAutoSave();
                this.showSaveStatus('üßπ –û—á–∏—â–µ–Ω—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã', 'success');
            }
            
            // –¢oggle metadata value
            toggleMetadataValue(field, value, button) {
                if (!metadata[field]) {
                    metadata[field] = [];
                }
                
                const index = metadata[field].indexOf(value);
                if (index === -1) {
                    metadata[field].push(value);
                    button.classList.add('active');
                    this.showSaveStatus(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${value}`, 'success');
                } else {
                    metadata[field].splice(index, 1);
                    button.classList.remove('active');
                    this.showSaveStatus(`‚ûñ –£–¥–∞–ª–µ–Ω–æ: ${value}`, 'success');
                }
                
                this.updateJsonEditor();
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            addNewCard() {
                const defaultId = `NEW-${Date.now().toString(36).toUpperCase()}`;
                const cardId = prompt('–í–≤–µ–¥–∏—Ç–µ ID –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: NEW-CARD):', defaultId);
                if (!cardId) return;
                
                if (cards[cardId]) {
                    this.showSaveStatus('‚ùå –ö–∞—Ä—Ç–æ—á–∫–∞ —Å —Ç–∞–∫–∏–º ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                const newCard = {
                    id: cardId,
                    text: '–ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞',
                    emoji: '‚ú®',
                    type: 'object',
                    category: '',
                    forms: {},
                    tags: ['–Ω–æ–≤–∞—è'],
                    difficulty: 1,
                    status: 'draft',
                    usageCount: 0,
                    created: new Date().toISOString(),
                    modified: new Date().toISOString(),
                    author: 'user',
                    version: 1,
                    color: '#E3F2FD',
                    borderColor: '#2196F3',
                    sections: ['–ì–ª–∞–≤–Ω–∞—è'],
                    metadata: {
                        allowedWith: [],
                        allowedObjects: [],
                        maxPeople: 0,
                        maxPets: 0,
                        maxPlaces: 0,
                        maxObjects: 0,
                        description: ''
                    }
                };
                
                cards[cardId] = newCard;
                this.saveCards();
                this.populateFilters();
                this.loadCard(cardId);
                this.renderCardList();
                this.showSaveStatus('‚ú® –ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
            }
            
            // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            duplicateCard() {
                if (!currentCardId) {
                    this.showSaveStatus('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è!', 'error');
                    return;
                }
                
                const original = cards[currentCardId];
                if (!original) return;
                
                const defaultId = `${original.id}-COPY`;
                const newId = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π ID –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–∞:', defaultId);
                if (!newId) return;
                
                if (cards[newId]) {
                    this.showSaveStatus('‚ùå –ö–∞—Ä—Ç–æ—á–∫–∞ —Å —Ç–∞–∫–∏–º ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞—Ç—å –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é
                const duplicate = JSON.parse(JSON.stringify(original));
                duplicate.id = newId;
                duplicate.text = duplicate.text + ' (–∫–æ–ø–∏—è)';
                duplicate.created = new Date().toISOString();
                duplicate.modified = new Date().toISOString();
                duplicate.usageCount = 0;
                duplicate.version = 1;
                
                cards[newId] = duplicate;
                this.saveCards();
                this.populateFilters();
                this.loadCard(newId);
                this.renderCardList();
                this.showSaveStatus('‚éò –ö–∞—Ä—Ç–æ—á–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            }
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            deleteCard() {
                if (selectedCards.size > 0) {
                    // –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                    if (!confirm(`üóëÔ∏è –£–¥–∞–ª–∏—Ç—å ${selectedCards.size} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫?`)) return;
                    
                    const deletedCount = selectedCards.size;
                    selectedCards.forEach(id => {
                        delete cards[id];
                    });
                    
                    selectedCards.clear();
                    currentCardId = null;
                    this.clearForm();
                    
                    this.showSaveStatus(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ ${deletedCount} –∫–∞—Ä—Ç–æ—á–µ–∫`, 'success');
                } else if (currentCardId) {
                    // –£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                    const cardName = cards[currentCardId]?.text || currentCardId;
                    if (!confirm(`üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É "${cardName}"?`)) return;
                    
                    delete cards[currentCardId];
                    currentCardId = null;
                    this.clearForm();
                    
                    this.showSaveStatus(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞: ${cardName}`, 'success');
                } else {
                    this.showSaveStatus('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!', 'error');
                    return;
                }
                
                this.saveCards();
                this.populateFilters();
                this.renderCardList();
            }
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            clearForm() {
                document.getElementById('editorForm').querySelectorAll('input, select, textarea').forEach(element => {
                    if (element.type !== 'button' && element.type !== 'submit') {
                        if (element.type === 'checkbox') {
                            element.checked = false;
                        } else if (element.type !== 'color') {
                            element.value = '';
                        }
                    }
                });
                
                // –°–±—Ä–æ—Å–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                document.getElementById('cardColor').value = '#E3F2FD';
                document.getElementById('borderColor').value = '#2196F3';
                document.getElementById('difficulty').value = 1;
                document.getElementById('status').value = 'active';
                document.getElementById('usageCount').value = 0;
                document.getElementById('author').value = 'user';
                document.getElementById('version').value = 1;
                document.getElementById('cardEmoji').value = '‚ú®';
                document.getElementById('cardText').value = '';
                document.getElementById('cardId').value = '';
                
                // –°–±—Ä–æ—Å–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                this.loadMetadataCard({});
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—É—é —Å–µ–∫—Ü–∏—é –∫–∞–∫ –≤—ã–±—Ä–∞–Ω–Ω—É—é
                const mainCheckbox = document.querySelector('#sectionsCheckbox input[value="–ì–ª–∞–≤–Ω–∞—è"]');
                if (mainCheckbox) {
                    mainCheckbox.checked = true;
                }
                
                // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                this.updateMiniPreview();
                
                // –°–±—Ä–æ—Å–∏—Ç—å ID
                currentCardId = null;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            updateBulkEditSection() {
                const bulkSection = document.getElementById('bulkEditSection');
                const bulkCount = document.getElementById('bulkCount');
                
                if (selectedCards.size > 1) {
                    bulkSection.style.display = 'block';
                    bulkCount.textContent = selectedCards.size;
                } else {
                    bulkSection.style.display = 'none';
                }
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è ID –∫–∞—Ä—Ç–æ—á–∫–∏
            validateCardId() {
                const idInput = document.getElementById('cardId');
                const id = idInput.value.trim();
                
                if (!id) return;
                
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç
                if (!/^[A-Z0-9-]+$/.test(id)) {
                    this.showSaveStatus('‚ùå ID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –¥–µ—Ñ–∏—Å—ã!', 'error');
                    idInput.focus();
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
                if (cards[id] && id !== currentCardId) {
                    this.showSaveStatus('‚ùå –ö–∞—Ä—Ç–æ—á–∫–∞ —Å —Ç–∞–∫–∏–º ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
                    idInput.focus();
                    return;
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
            onCardTypeChange() {
                const type = document.getElementById('cardType').value;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å ID –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
                const idInput = document.getElementById('cardId');
                if (!idInput.value && currentCardId) {
                    const prefix = type.toUpperCase().substring(0, 3);
                    const random = Math.floor(Math.random() * 1000);
                    const newId = `${prefix}-${random}`;
                    idInput.value = newId;
                }
            }
            
            // –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
            findDuplicates() {
                this.showSaveStatus('üîç –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤...', 'saving');
                
                setTimeout(() => {
                    const duplicates = {
                        byText: {},
                        byEmoji: {},
                        byTextAndEmoji: {}
                    };
                    
                    // –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –∫–ª—é—á–∞–º
                    Object.values(cards).forEach(card => {
                        // –ü–æ —Ç–µ–∫—Å—Ç—É
                        if (card.text) {
                            const key = card.text.toLowerCase().trim();
                            if (!duplicates.byText[key]) {
                                duplicates.byText[key] = [];
                            }
                            duplicates.byText[key].push(card);
                        }
                        
                        // –ü–æ —ç–º–æ–¥–∑–∏
                        if (card.emoji) {
                            if (!duplicates.byEmoji[card.emoji]) {
                                duplicates.byEmoji[card.emoji] = [];
                            }
                            duplicates.byEmoji[card.emoji].push(card);
                        }
                        
                        // –ü–æ —Ç–µ–∫—Å—Ç—É –∏ —ç–º–æ–¥–∑–∏
                        if (card.text && card.emoji) {
                            const key = `${card.text.toLowerCase().trim()}|${card.emoji}`;
                            if (!duplicates.byTextAndEmoji[key]) {
                                duplicates.byTextAndEmoji[key] = [];
                            }
                            duplicates.byTextAndEmoji[key].push(card);
                        }
                    });
                    
                    // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, —É –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–µ 1 –∫–∞—Ä—Ç–æ—á–∫–∏
                    const result = {
                        text: [],
                        emoji: [],
                        textAndEmoji: []
                    };
                    
                    Object.keys(duplicates.byText).forEach(key => {
                        if (duplicates.byText[key].length > 1) {
                            result.text.push({
                                value: key,
                                cards: duplicates.byText[key]
                            });
                        }
                    });
                    
                    Object.keys(duplicates.byEmoji).forEach(key => {
                        if (duplicates.byEmoji[key].length > 1) {
                            result.emoji.push({
                                value: key,
                                cards: duplicates.byEmoji[key]
                            });
                        }
                    });
                    
                    Object.keys(duplicates.byTextAndEmoji).forEach(key => {
                        if (duplicates.byTextAndEmoji[key].length > 1) {
                            const [text, emoji] = key.split('|');
                            result.textAndEmoji.push({
                                text: text,
                                emoji: emoji,
                                cards: duplicates.byTextAndEmoji[key]
                            });
                        }
                    });
                    
                    this.showDuplicatesModal(result);
                    this.showSaveStatus('‚úÖ –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
                }, 500);
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
            showDuplicatesModal(duplicates) {
                const modal = document.getElementById('duplicatesModal');
                const list = document.getElementById('duplicatesList');
                
                list.innerHTML = '';
                
                let hasDuplicates = false;
                
                // –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —Ç–µ–∫—Å—Ç—É
                if (duplicates.text.length > 0) {
                    hasDuplicates = true;
                    const section = document.createElement('div');
                    section.className = 'duplicate-item';
                    section.innerHTML = '<h5>üìù –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —Ç–µ–∫—Å—Ç—É:</h5>';
                    
                    duplicates.text.forEach(dup => {
                        const div = document.createElement('div');
                        div.className = 'duplicate-cards';
                        div.innerHTML = `<p><strong>–¢–µ–∫—Å—Ç:</strong> "${dup.value}"</p>`;
                        
                        dup.cards.forEach(card => {
                            const cardDiv = document.createElement('div');
                            cardDiv.className = 'duplicate-card';
                            cardDiv.innerHTML = `
                                <span>${card.emoji || 'üìÑ'} ${card.text} (${card.id})</span>
                                <button class="btn btn-secondary btn-small" data-id="${card.id}" style="padding: 6px 12px; font-size: 12px;">–ü–µ—Ä–µ–π—Ç–∏</button>
                            `;
                            
                            cardDiv.querySelector('button').addEventListener('click', (e) => {
                                this.loadCard(card.id);
                                modal.classList.remove('active');
                            });
                            
                            div.appendChild(cardDiv);
                        });
                        
                        section.appendChild(div);
                    });
                    
                    list.appendChild(section);
                }
                
                // –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —ç–º–æ–¥–∑–∏
                if (duplicates.emoji.length > 0) {
                    hasDuplicates = true;
                    const section = document.createElement('div');
                    section.className = 'duplicate-item';
                    section.innerHTML = '<h5>üé® –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —ç–º–æ–¥–∑–∏:</h5>';
                    
                    duplicates.emoji.forEach(dup => {
                        const div = document.createElement('div');
                        div.className = 'duplicate-cards';
                        div.innerHTML = `<p><strong>–≠–º–æ–¥–∑–∏:</strong> ${dup.value}</p>`;
                        
                        dup.cards.forEach(card => {
                            const cardDiv = document.createElement('div');
                            cardDiv.className = 'duplicate-card';
                            cardDiv.innerHTML = `
                                <span>${card.emoji || 'üìÑ'} ${card.text} (${card.id})</span>
                                <button class="btn btn-secondary btn-small" data-id="${card.id}" style="padding: 6px 12px; font-size: 12px;">–ü–µ—Ä–µ–π—Ç–∏</button>
                            `;
                            
                            cardDiv.querySelector('button').addEventListener('click', (e) => {
                                this.loadCard(card.id);
                                modal.classList.remove('active');
                            });
                            
                            div.appendChild(cardDiv);
                        });
                        
                        section.appendChild(div);
                    });
                    
                    list.appendChild(section);
                }
                
                // –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —Ç–µ–∫—Å—Ç—É –∏ —ç–º–æ–¥–∑–∏
                if (duplicates.textAndEmoji.length > 0) {
                    hasDuplicates = true;
                    const section = document.createElement('div');
                    section.className = 'duplicate-item';
                    section.innerHTML = '<h5>üìùüé® –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —Ç–µ–∫—Å—Ç—É –∏ —ç–º–æ–¥–∑–∏:</h5>';
                    
                    duplicates.textAndEmoji.forEach(dup => {
                        const div = document.createElement('div');
                        div.className = 'duplicate-cards';
                        div.innerHTML = `<p><strong>–¢–µ–∫—Å—Ç:</strong> "${dup.text}" <strong>–≠–º–æ–¥–∑–∏:</strong> ${dup.emoji}</p>`;
                        
                        dup.cards.forEach(card => {
                            const cardDiv = document.createElement('div');
                            cardDiv.className = 'duplicate-card';
                            cardDiv.innerHTML = `
                                <span>${card.emoji || 'üìÑ'} ${card.text} (${card.id})</span>
                                <button class="btn btn-secondary btn-small" data-id="${card.id}" style="padding: 6px 12px; font-size: 12px;">–ü–µ—Ä–µ–π—Ç–∏</button>
                            `;
                            
                            cardDiv.querySelector('button').addEventListener('click', (e) => {
                                this.loadCard(card.id);
                                modal.classList.remove('active');
                            });
                            
                            div.appendChild(cardDiv);
                        });
                        
                        section.appendChild(div);
                    });
                    
                    list.appendChild(section);
                }
                
                if (!hasDuplicates) {
                    list.innerHTML = `
                        <div class="duplicate-item" style="text-align: center; padding: 40px 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>
                            <p style="font-size: 18px; color: #10b981; font-weight: 600;">–î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!</p>
                            <p style="color: #64748b; margin-top: 8px;">–í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã</p>
                        </div>
                    `;
                }
                
                modal.classList.add('active');
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞
            showImportModal() {
                document.getElementById('importModal').classList.add('active');
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–∞
            handleFileImport(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('importJson').value = e.target.result;
                };
                reader.readAsText(file);
            }
            
            // –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç
            async executeImport() {
                const importJson = document.getElementById('importJson').value;
                const importMode = document.getElementById('importMode').value;
                const validateOnImport = document.getElementById('validateOnImport').checked;
                
                if (!importJson) {
                    this.showSaveStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ JSON –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞!', 'error');
                    return;
                }
                
                try {
                    const importedData = JSON.parse(importJson);
                    const importedCards = importedData.cards || importedData;
                    
                    // –í–∞–ª–∏–¥–∞—Ü–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    if (validateOnImport) {
                        const validation = this.validateCardSet(importedCards);
                        if (validation.errors.length > 0) {
                            alert(`–ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏:\n${validation.errors.join('\n')}\n\n–ò–º–ø–æ—Ä—Ç –æ—Ç–º–µ–Ω–µ–Ω.`);
                            return;
                        }
                    }
                    
                    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                    let importedCount = 0;
                    switch (importMode) {
                        case 'merge':
                            // –û–±—ä–µ–¥–∏–Ω–∏—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
                            importedCount = Object.keys(importedCards).length;
                            Object.assign(cards, importedCards);
                            break;
                        case 'replace':
                            // –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ
                            importedCount = Object.keys(importedCards).length;
                            cards = importedCards;
                            break;
                        case 'update':
                            // –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
                            Object.keys(importedCards).forEach(id => {
                                if (cards[id]) {
                                    cards[id] = importedCards[id];
                                    importedCount++;
                                }
                            });
                            break;
                        case 'add':
                            // –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ
                            Object.keys(importedCards).forEach(id => {
                                if (!cards[id]) {
                                    cards[id] = importedCards[id];
                                    importedCount++;
                                }
                            });
                            break;
                    }
                    
                    this.saveCards();
                    this.populateFilters();
                    this.renderCardList();
                    
                    document.getElementById('importModal').classList.remove('active');
                    this.showSaveStatus(`‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ${importedCount}`, 'success');
                } catch (e) {
                    this.showSaveStatus(`‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ${e.message}`, 'error');
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
            showExportModal() {
                document.getElementById('exportModal').classList.add('active');
                this.updateExportPreview();
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞
            updateExportPreview() {
                const scope = document.getElementById('exportScope').value;
                const format = document.getElementById('exportFormat').value;
                
                let cardsToExport = {};
                
                switch (scope) {
                    case 'all':
                        cardsToExport = cards;
                        break;
                    case 'selected':
                        selectedCards.forEach(id => {
                            if (cards[id]) cardsToExport[id] = cards[id];
                        });
                        break;
                    case 'filtered':
                        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ
                        cardsToExport = cards;
                        break;
                    case 'current':
                        if (currentCardId) {
                            cardsToExport[currentCardId] = cards[currentCardId];
                        }
                        break;
                }
                
                // –£–¥–∞–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                const exportSystemFields = document.getElementById('exportSystemFields').checked;
                const exportUsageCount = document.getElementById('exportUsageCount').checked;
                
                let exportData = { cards: cardsToExport };
                
                if (!exportSystemFields || !exportUsageCount) {
                    const cleanedCards = {};
                    Object.keys(cardsToExport).forEach(id => {
                        const card = { ...cardsToExport[id] };
                        
                        if (!exportSystemFields) {
                            delete card.created;
                            delete card.modified;
                            delete card.author;
                            delete card.version;
                        }
                        
                        if (!exportUsageCount) {
                            delete card.usageCount;
                        }
                        
                        cleanedCards[id] = card;
                    });
                    
                    exportData = { cards: cleanedCards };
                }
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                let previewText = '';
                switch (format) {
                    case 'json':
                        previewText = JSON.stringify(exportData, null, 2);
                        break;
                    case 'json-min':
                        previewText = JSON.stringify(exportData);
                        break;
                    case 'csv':
                        previewText = this.convertToCSV(exportData.cards);
                        break;
                }
                
                document.getElementById('exportPreview').value = previewText;
            }
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CSV
            convertToCSV(cardsObj) {
                const cardsArray = Object.values(cardsObj);
                if (cardsArray.length === 0) return '';
                
                // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è
                const allFields = new Set();
                cardsArray.forEach(card => {
                    Object.keys(card).forEach(key => allFields.add(key));
                    if (card.metadata) {
                        Object.keys(card.metadata).forEach(key => allFields.add(`metadata.${key}`));
                    }
                    if (card.forms) {
                        Object.keys(card.forms).forEach(key => allFields.add(`forms.${key}`));
                    }
                });
                
                // –°–æ–∑–¥–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
                const header = Array.from(allFields).join(',');
                let csv = header + '\n';
                
                // –î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                cardsArray.forEach(card => {
                    const row = [];
                    allFields.forEach(field => {
                        let value = '';
                        
                        if (field.includes('.')) {
                            const [parent, child] = field.split('.');
                            if (card[parent] && card[parent][child] !== undefined) {
                                value = card[parent][child];
                            }
                        } else {
                            value = card[field];
                        }
                        
                        // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–∞—Å—Å–∏–≤—ã –∏ –æ–±—ä–µ–∫—Ç—ã
                        if (Array.isArray(value)) {
                            value = value.join(';');
                        } else if (typeof value === 'object') {
                            value = JSON.stringify(value);
                        }
                        
                        // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—è—Ç—ã–µ –∏ –∫–∞–≤—ã—á–∫–∏
                        if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                            value = `"${value.replace(/"/g, '""')}"`;
                        }
                        
                        row.push(value || '');
                    });
                    
                    csv += row.join(',') + '\n';
                });
                
                return csv;
            }
            
            // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç
            copyExport() {
                const preview = document.getElementById('exportPreview');
                preview.select();
                document.execCommand('copy');
                this.showSaveStatus('üìã –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
            }
            
            // –°–∫–∞—á–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç
            downloadExport() {
                const format = document.getElementById('exportFormat').value;
                const preview = document.getElementById('exportPreview').value;
                const scope = document.getElementById('exportScope').value;
                
                const extension = format === 'csv' ? 'csv' : 'json';
                const filename = `komkom-cards-${scope}-${new Date().toISOString().slice(0,10)}.${extension}`;
                
                const blob = new Blob([preview], { type: format === 'csv' ? 'text/csv' : 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                
                URL.revokeObjectURL(url);
                this.showSaveStatus('üíæ –§–∞–π–ª —Å–∫–∞—á–∞–Ω!', 'success');
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
            showServerLoadModal() {
                document.getElementById('serverLoadModal').classList.add('active');
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
            async loadFromServer() {
                const url = document.getElementById('serverUrl').value;
                const mode = document.getElementById('serverLoadMode').value;
                
                if (!url) {
                    this.showSaveStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏!', 'error');
                    return;
                }
                
                const statusDiv = document.getElementById('serverStatus');
                statusDiv.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
                statusDiv.style.color = '#f59e0b';
                statusDiv.style.fontWeight = '600';
                
                try {
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const serverCards = data.cards || data;
                    
                    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º –∑–∞–≥—Ä—É–∑–∫–∏
                    let loadedCount = 0;
                    switch (mode) {
                        case 'merge':
                            loadedCount = Object.keys(serverCards).length;
                            Object.assign(cards, serverCards);
                            break;
                        case 'replace':
                            loadedCount = Object.keys(serverCards).length;
                            cards = serverCards;
                            break;
                    }
                    
                    this.saveCards();
                    this.populateFilters();
                    this.renderCardList();
                    
                    statusDiv.textContent = `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ! –ö–∞—Ä—Ç–æ—á–µ–∫: ${loadedCount}`;
                    statusDiv.style.color = '#10b981';
                    
                    setTimeout(() => {
                        document.getElementById('serverLoadModal').classList.remove('active');
                        this.showSaveStatus(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–∞: ${loadedCount} –∫–∞—Ä—Ç–æ—á–µ–∫`, 'success');
                    }, 1500);
                    
                } catch (error) {
                    statusDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                    statusDiv.style.color = '#ef4444';
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
                    this.showSaveStatus(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
                }
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
            validateCards() {
                this.showSaveStatus('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫...', 'saving');
                
                setTimeout(() => {
                    const validation = this.validateCardSet(cards);
                    const resultsDiv = document.getElementById('validationResults');
                    const listDiv = document.getElementById('validationList');
                    
                    listDiv.innerHTML = '';
                    
                    if (validation.errors.length === 0 && validation.warnings.length === 0) {
                        listDiv.innerHTML = `
                            <div class="validation-item success">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="font-size: 20px;">‚úÖ</div>
                                    <div>
                                        <strong>–í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∞–ª–∏–¥–Ω—ã!</strong>
                                        <div style="font-size: 13px; color: #047857; margin-top: 4px;">
                                            –ù–∞–π–¥–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ${Object.keys(cards).length}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        validation.errors.forEach(error => {
                            const div = document.createElement('div');
                            div.className = 'validation-item error';
                            div.innerHTML = `
                                <div style="display: flex; align-items: flex-start; gap: 10px;">
                                    <div style="font-size: 20px;">‚ùå</div>
                                    <div>${error}</div>
                                </div>
                            `;
                            listDiv.appendChild(div);
                        });
                        
                        validation.warnings.forEach(warning => {
                            const div = document.createElement('div');
                            div.className = 'validation-item warning';
                            div.innerHTML = `
                                <div style="display: flex; align-items: flex-start; gap: 10px;">
                                    <div style="font-size: 20px;">‚ö†Ô∏è</div>
                                    <div>${warning}</div>
                                </div>
                            `;
                            listDiv.appendChild(div);
                        });
                    }
                    
                    resultsDiv.style.display = 'block';
                    
                    // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
                    resultsDiv.scrollIntoView({ behavior: 'smooth' });
                    
                    this.showSaveStatus('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
                }, 500);
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–±–æ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
            validateCardSet(cardSet) {
                const errors = [];
                const warnings = [];
                const ids = new Set();
                
                Object.keys(cardSet).forEach(id => {
                    const card = cardSet[id];
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ID
                    if (!id) {
                        errors.push(`–ü—É—Å—Ç–æ–π ID —É –∫–∞—Ä—Ç–æ—á–∫–∏`);
                        return;
                    }
                    
                    if (ids.has(id)) {
                        errors.push(`–î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è ID: ${id}`);
                    }
                    ids.add(id);
                    
                    if (!/^[A-Z0-9-]+$/.test(id)) {
                        warnings.push(`–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID: ${id}`);
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                    if (!card.text) {
                        errors.push(`–ö–∞—Ä—Ç–æ—á–∫–∞ ${id}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—Å—Ç`);
                    }
                    
                    if (!card.type) {
                        errors.push(`–ö–∞—Ä—Ç–æ—á–∫–∞ ${id}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø`);
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    if (card.category && !cardSet[card.category]) {
                        warnings.push(`–ö–∞—Ä—Ç–æ—á–∫–∞ ${id}: –∫–∞—Ç–µ–≥–æ—Ä–∏—è "${card.category}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å allowedObjects
                    if (card.metadata?.allowedObjects) {
                        card.metadata.allowedObjects.forEach(objId => {
                            if (!cardSet[objId]) {
                                warnings.push(`–ö–∞—Ä—Ç–æ—á–∫–∞ ${id}: –æ–±—ä–µ–∫—Ç "${objId}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                            }
                        });
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å forms
                    if (card.forms) {
                        const validForms = ['accusative', 'genitive', 'dative', 'instrumental', 'prepositional', 'with', 'in', 'on'];
                        Object.keys(card.forms).forEach(form => {
                            if (!validForms.includes(form)) {
                                warnings.push(`–ö–∞—Ä—Ç–æ—á–∫–∞ ${id}: –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å–ª–æ–≤–∞: ${form}`);
                            }
                        });
                    }
                });
                
                return { errors, warnings };
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            window.cardEditor = new CardEditor();
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            setTimeout(() => {
                if (unsavedChanges) {
                    window.cardEditor.showSaveStatus('‚úèÔ∏è –ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è', 'saving');
                }
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                setTimeout(() => {
                    window.cardEditor.showSaveStatus('‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ –ö–æ–º-–ö–æ–º!', 'success');
                }, 1000);
            }, 1000);
        });
    </script>
</body>
</html>
